<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Chủ - Giao Dịch Trung Gian</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="home.css">
    <!-- Thư viện Firebase -->
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
</head>
<body>
    <header class="header">
        <div class="container header-container">
            <div class="logo">
                <img src="logo.jpg" alt="Logo" />
            </div>
            <div class="user-info">
                <!-- Thông tin người dùng -->
                <span id="username" class="user-name">Xin chào, <strong>Đang tải...</strong></span>
                <span id="balance" class="user-balance">Số dư: <strong>Đang tải...</strong></span>
            </div>
            <nav class="nav">
                <ul>
                    <li><a href="home.html">Trang Chủ</a></li>
                    <li><a href="profile.html">Trang Cá Nhân</a></li>
                    <li><button id="logout-btn" class="logout-btn">Đăng Xuất</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h1>Chào Mừng Đến Với Giao Dịch Trung Gian</h1>
                <p>An toàn, nhanh chóng và đáng tin cậy.</p>
                <button class="cta-btn" onclick="startNow()">Bắt Đầu Ngay</button>
            </div>
        </section>

        <section class="main-content">
            <div class="container">
                <h2 class="section-title">Chức Năng Chính</h2>
                <div class="features">
                    <!-- Chức năng bên trả tiền -->
                    <div class="feature">
                        <h3>Bên Trả Tiền</h3>
                        <p>Thanh toán an toàn qua trung gian, bảo vệ quyền lợi của bạn.</p>
                        <button class="action-btn" onclick="goToPayment()">Thực Hiện Trả Tiền</button>
                    </div>
                    <!-- Chức năng trao đổi vật phẩm -->
                    <div class="feature">
                        <h3>Trao Đổi Vật Phẩm</h3>
                        <p>Giao dịch vật phẩm hoặc hàng hóa với người khác dễ dàng.</p>
                        <button class="action-btn" onclick="goToExchange()">Thực Hiện Trao Đổi</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>&copy; 2024 Giao Dịch Trung Gian. All rights reserved.</p>
    </footer>

    <!-- Script Firebase -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDo5POI_MkDJyNE5y_7BIdfs-B2mj1iUBY",
            authDomain: "csdl-web-giaodich.firebaseapp.com",
            databaseURL: "https://csdl-web-giaodich-default-rtdb.firebaseio.com",
            projectId: "csdl-web-giaodich",
            storageBucket: "csdl-web-giaodich.appspot.com",
            messagingSenderId: "834585121842",
            appId: "1:834585121842:web:bca26240e1e5187792d82b",
            measurementId: "G-5VDD2LKEKV"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Kiểm tra trạng thái đăng nhập
        firebase.auth().onAuthStateChanged(async (user) => {
            if (user) {
                try {
                    // Lấy thông tin user từ Authentication
                    const username = user.displayName || user.email.split('@')[0]; // Sử dụng email nếu không có displayName
                    console.log("Đăng nhập bởi:", username);

                    // Truy vấn dữ liệu người dùng từ Firebase Database
                    const snapshot = await firebase.database().ref('users/' + username).once('value');

                    if (snapshot.exists()) {
                        const userData = snapshot.val();

                        // Hiển thị fullname và số dư
                        document.getElementById("username").innerHTML = `Xin chào, <strong>${userData.fullname}</strong>`;
                        document.getElementById("balance").innerHTML = `Số dư: <strong>${Number(userData.balance).toLocaleString()} VNĐ</strong>`;
                    } else {
                        console.error("Người dùng không tồn tại trong cơ sở dữ liệu.");
                        document.getElementById("username").innerHTML = `Xin chào, <strong>Không xác định</strong>`;
                        document.getElementById("balance").innerHTML = `Số dư: <strong>0 VNĐ</strong>`;
                    }
                } catch (error) {
                    console.error("Lỗi khi truy vấn dữ liệu Firebase:", error);
                }
            } else {
                // Nếu chưa đăng nhập, chuyển hướng về trang chủ
                console.log("Người dùng chưa đăng nhập. Chuyển hướng về trang chủ.");
                window.location.href = "../index.html";
            }
        });

        // Xử lý nút đăng xuất
        document.getElementById("logout-btn").addEventListener("click", async function () {
            try {
                await firebase.auth().signOut();
                console.log("Đăng xuất thành công.");
                window.location.href = "../index.html"; // Chuyển hướng về trang chủ
            } catch (error) {
                console.error("Lỗi khi đăng xuất:", error);
            }
        });

        // Các chức năng khác
        function startNow() {
            console.log("Chức năng bắt đầu ngay!");
        }

        function goToPayment() {
            window.location.href = "payment.html";
        }

        function goToExchange() {
            window.location.href = "exchange.html";
        }
    </script>
</body>
</html>
